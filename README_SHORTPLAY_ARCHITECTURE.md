# ShortplayEntryPage æ¶æ„æ–‡æ¡£ - å¿«é€Ÿå¯¼èˆª

æœ¬æ–‡æ¡£æ˜¯ä¸€é”®åˆ›ä½œé¡µé¢ï¼ˆShortplayEntryPageï¼‰çš„å®Œæ•´æ¶æ„å‚è€ƒï¼ŒåŒ…å«ç»„ä»¶ç»“æ„ã€æ•°æ®æµã€APIè°ƒç”¨ã€çŠ¶æ€ç®¡ç†ç­‰å…³é”®ä¿¡æ¯ã€‚

## ğŸ“š æ–‡æ¡£ç´¢å¼•

### 1. **SHORTPLAY_STRUCTURE_ANALYSIS.md** (ä¸»æ–‡æ¡£ - 46KB)
   å®Œæ•´çš„æ¶æ„åˆ†ææ–‡æ¡£ï¼ŒåŒ…å«ï¼š
   - é¡¹ç›®æ¦‚è§ˆå’Œä»£ç ç»Ÿè®¡
   - å®Œæ•´çš„æ–‡ä»¶ç»“æ„æ ‘
   - æ ¸å¿ƒç»„ä»¶æ¶æ„è¯¦è§£
   - UIå¸ƒå±€ç»“æ„ï¼ˆ3æ è®¾è®¡è¯¦ç»†åˆ†æï¼‰
   - 13ä¸ªå­ç»„ä»¶å®¶æ—çš„è¯¦ç»†è¯´æ˜
   - æ•°æ®æµå‘åˆ†æï¼ˆå…¨å±€çŠ¶æ€ã€Propsæµå‘ã€äº‹ä»¶å¤„ç†ï¼‰
   - 5ä¸ªå†…éƒ¨Hooks + 3ä¸ªå…¨å±€Hooksçš„è¯¦ç»†è¯´æ˜
   - 20+ä¸ªAPIæœåŠ¡çš„å®Œæ•´åˆ—è¡¨
   - çŠ¶æ€ç®¡ç†ä½“ç³»ï¼ˆåˆ†å±‚ç»“æ„ã€æ›´æ–°æµç¨‹ã€ä¸å˜æ€§åŸåˆ™ï¼‰
   - è¶…å¤§ç»„ä»¶å…³ç³»æ ‘ï¼ˆå«æ‰€æœ‰å­ç»„ä»¶å’Œpropsï¼‰
   - å…³é”®æŠ€æœ¯ç‚¹å’Œæ€»ç»“

   **ä½•æ—¶æŸ¥é˜…**ï¼šéœ€è¦äº†è§£æ•´ä¸ªç³»ç»Ÿçš„å…¨è²Œã€å…·ä½“å®ç°ç»†èŠ‚ã€ç»„ä»¶é—´è°ƒç”¨å…³ç³»

### 2. **COMPONENT_DEPENDENCY_MAP.md** (ä¾èµ–å…³ç³»å›¾ - è¡¥å……æ–‡æ¡£)
   ç»„ä»¶ä¾èµ–å’Œæ•°æ®æµå…³ç³»å›¾ï¼š
   - æ–‡ä»¶å¼•å…¥å…³ç³»å›¾ï¼ˆimportä¾èµ–ï¼‰
   - è¯¦ç»†çš„ç»„ä»¶æ ‘ç»“æ„ï¼ˆå«æ‰€æœ‰UIå…ƒç´ ï¼‰
   - ä¸‰ç§ä¸»è¦æ•°æ®æµæ¨¡å¼ï¼ˆå•å‘æµã€æ‹–æ‹½æ’åºã€æ—¶é—´ç¼–è¾‘ï¼‰
   - Propsä¾èµ–å…³ç³»å›¾
   - Stateä¾èµ–å…³ç³»å›¾
   - APIè°ƒç”¨å…³ç³»å®Œæ•´å›¾
   - çŠ¶æ€ä¼˜åŒ–å»ºè®®å’Œé‡æ„æ–¹æ¡ˆ

   **ä½•æ—¶æŸ¥é˜…**ï¼šéœ€è¦äº†è§£ç»„ä»¶é—´çš„ä¾èµ–å…³ç³»ã€æ•°æ®å¦‚ä½•æµåŠ¨ã€å¦‚ä½•ä¼˜åŒ–çŠ¶æ€ç®¡ç†

## ğŸ—ï¸ å¿«é€Ÿæ¶æ„æ¦‚è§ˆ

### æ ¸å¿ƒç»“æ„ï¼š3æ å¸ƒå±€ + åº•éƒ¨è¾“å…¥

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é¡¶éƒ¨å¯¼èˆª (Logo + Tabåˆ‡æ¢: è„šæœ¬|éŸ³é¢‘|å›¾ç‰‡|è§†é¢‘)  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å·¦ä¾§é¢æ¿    â”‚   ä¸­é—´åŒºåŸŸ        â”‚   å³ä¾§é¢æ¿    â”‚
â”‚ (flex: 1)    â”‚  (flex: 2)        â”‚  (flex: 2)    â”‚
â”‚              â”‚                  â”‚               â”‚
â”‚ â€¢ è„šæœ¬ç”Ÿæˆ   â”‚ â€¢ åœºæ™¯é€‰æ‹©å™¨     â”‚ â€¢ è§†é¢‘é¢„è§ˆ    â”‚
â”‚ â€¢ éŸ³è‰²èµ„æº   â”‚ â€¢ å†…å®¹åˆ—è¡¨       â”‚ â€¢ åœºæ™¯ç¼–è¾‘    â”‚
â”‚ â€¢ å¯ç”¨èµ„æº   â”‚ â€¢ å¯æ‹–æ‹½é‡æ’åº   â”‚ â€¢ æ’­æ”¾æ§åˆ¶    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åº•éƒ¨è¾“å…¥åŒº (æ¨¡å‹é€‰æ‹© + å‚æ•° + è¾“å…¥æ¡† + ç”ŸæˆæŒ‰é’®) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç‰¹æ€§

| ç‰¹æ€§ | è¯´æ˜ | ä½ç½® |
|------|------|------|
| **4ä¸ªç‹¬ç«‹å·¥ä½œæµ** | è„šæœ¬ã€éŸ³é¢‘ã€å›¾ç‰‡ã€è§†é¢‘ | activeTabåˆ‡æ¢ |
| **åœºæ™¯ç®¡ç†** | æ”¯æŒå¤šåœºæ™¯ï¼Œæ¯ä¸ªåœºæ™¯ç‹¬ç«‹å†…å®¹ | ä¸­é—´åŒºåŸŸå¤´éƒ¨ |
| **æ‹–æ‹½æ’åº** | DnD Kitå®ç°ï¼Œæ‰€æœ‰åˆ—è¡¨æ”¯æŒ | ä¸­é—´åŒºåŸŸå†…å®¹åˆ—è¡¨ |
| **å®æ—¶ç¼–è¾‘** | å†…å®¹ã€æ—¶é—´ã€è§’è‰²ç­‰å¯ç¼–è¾‘ | å„tabå¯¹åº”é¡¹ |
| **èµ„æºåº“** | éŸ³è‰²ã€éŸ³æ•ˆã€å›¾ç‰‡ç­‰å†å²è®°å½• | å·¦ä¾§é¢æ¿ |
| **AIç”Ÿæˆ** | è„šæœ¬ã€å›¾ç‰‡ã€è§†é¢‘ã€BGM | åº•éƒ¨ç”ŸæˆæŒ‰é’® |
| **è¿›åº¦è·Ÿè¸ª** | è§†é¢‘ç”Ÿæˆå®æ—¶è½®è¯¢ | å³ä¾§è§†é¢‘åŒº |

## ğŸ¯ å¿«é€Ÿå®šä½åŠŸèƒ½

### æƒ³è¦ä¿®æ”¹çš„åŠŸèƒ½ â†’ æŸ¥çœ‹å¯¹åº”ä½ç½®

**è„šæœ¬ç›¸å…³**
- è„šæœ¬ç”Ÿæˆï¼š`ShortplayEntryPage.tsx` (handleGenerateå‡½æ•°)
- åœºæ™¯å†…å®¹ç¼–è¾‘ï¼š`SortableScriptItem.tsx` + useScriptGeneration hook
- åœºæ™¯åˆ—è¡¨ï¼š`SectionHeader.tsx`

**éŸ³é¢‘ç›¸å…³**
- éŸ³è‰²ç®¡ç†ï¼š`AudioResourcePanel.tsx` + useAudioManagement hook
- éŸ³è‰²é€‰æ‹©ï¼š`SortableAudioItem.tsx`
- BGMç”Ÿæˆï¼š`ShortplayEntryPage.tsx` (handleBgmGenerateå‡½æ•°)

**å›¾ç‰‡ç›¸å…³**
- å›¾ç‰‡ç”Ÿæˆï¼š`ShortplayEntryPage.tsx` (handleImageGenerateå‡½æ•°)
- åˆ†é•œæ¿ç®¡ç†ï¼š`StoryboardList.tsx` + useImageManagement hook
- å›¾ç‰‡ä¸Šä¼ ï¼š`BottomInputArea.tsx` + handleMultipleFileUpload

**è§†é¢‘ç›¸å…³**
- è§†é¢‘ç”Ÿæˆï¼š`ShortplayEntryPage.tsx` (handleVideoGenerateå‡½æ•°)
- è§†é¢‘é¢„è§ˆï¼š`ShortplayEntryPage.tsx` (è§†é¢‘å…ƒç´  + æ§åˆ¶æ )
- è¿›åº¦è½®è¯¢ï¼š`ShortplayEntryPage.tsx` (pollVideoProgresså‡½æ•°)

**UIå¸ƒå±€**
- å·¦ä¾§é¢æ¿ï¼šAudioResourcePanel + å†…å®¹åŒº
- ä¸­é—´åŒºåŸŸï¼šSectionHeader + DnD Content List
- å³ä¾§é¢æ¿ï¼šè§†é¢‘é¢„è§ˆ + ç¼–è¾‘æ¨¡å¼

## ğŸ“Š æ•°æ®æµé€ŸæŸ¥è¡¨

### APIè°ƒç”¨æµç¨‹ï¼ˆä»¥è„šæœ¬ç”Ÿæˆä¸ºä¾‹ï¼‰

```
1. ç”¨æˆ·è¾“å…¥ â†’ userInput state
2. ç‚¹å‡»ç”Ÿæˆ â†’ handleGenerate()
3. è°ƒç”¨API â†’ createSeries(userInput)
4. è·å¾—æ•°æ® â†’ { seriesId, scenes[] }
5. çŠ¶æ€æ›´æ–° â†’ setSeriesId, setScenesData, setSceneOptions
6. åŠ è½½å†…å®¹ â†’ loadSceneContent(sceneId)
7. UIæ›´æ–° â†’ åœºæ™¯é€‰æ‹©å™¨ã€å†…å®¹åˆ—è¡¨åˆ·æ–°
```

### æ‹–æ‹½æ’åºæµç¨‹

```
1. ç”¨æˆ·æ‹–æ‹½ â†’ handleDragEnd(event)
2. è®¡ç®—ä½ç½® â†’ arrayMove(items, oldIndex, newIndex)
3. æœ¬åœ°æ›´æ–° â†’ setSceneContent(newItems)
4. APIåŒæ­¥ â†’ /scene/content/reorder
5. ç»“æœå¤„ç† â†’ toast + å¯é€‰é‡æ–°åŠ è½½
```

## ğŸ”§ å¸¸è§ä¿®æ”¹åœºæ™¯

### 1. æ·»åŠ æ–°çš„ç”Ÿæˆæ¨¡å‹é€‰é¡¹

**ä½ç½®**: `BottomInputArea.tsx`
- Model Selectç»„ä»¶çš„optionsæ ¹æ®activeTabåŠ¨æ€ç”Ÿæˆ
- ä¿®æ”¹å¯¹åº”tabçš„æ¨¡å‹åˆ—è¡¨

**æ­¥éª¤**:
```typescript
// åœ¨getAvailableModelså‡½æ•°ä¸­æ·»åŠ æ–°æ¨¡å‹
// ä¾‹å¦‚ï¼šè„šæœ¬tabçš„æ¨¡å‹åˆ—è¡¨
const scriptModels = [
  { value: 'deepseek', label: 'DeepSeek' },
  { value: 'new-model', label: 'New Model' }  // æ·»åŠ è¿™è¡Œ
];
```

### 2. æ–°å¢ç¼–è¾‘å­—æ®µ

**ä½ç½®**: `SortableScriptItem.tsx` æˆ–ç›¸å…³ç»„ä»¶
- åœ¨editingStateä¸­æ·»åŠ æ–°state
- åœ¨æ¸²æŸ“ä¸­æ·»åŠ å¯¹åº”è¾“å…¥æ¡†
- åœ¨ä¿å­˜æ—¶è°ƒç”¨APIæ›´æ–°

### 3. ä¿®æ”¹æ—¶é—´æ ¼å¼

**ä½ç½®**: `ShortplayEntryPage/utils/formatTime.ts`
- formatTimeå‡½æ•°å¤„ç†æ ¼å¼åŒ–
- parseTimeRangeå‡½æ•°å¤„ç†è§£æ
- validateTimeLogicå‡½æ•°å¤„ç†éªŒè¯

### 4. æ·»åŠ æ–°çš„èµ„æºç±»å‹

**æ­¥éª¤**:
1. åœ¨types/index.tsä¸­å®šä¹‰æ–°çš„Itemç±»å‹
2. åœ¨hooksä¸­åˆ›å»ºç®¡ç†hook
3. åˆ›å»ºå¯¹åº”çš„Sortableç»„ä»¶
4. åœ¨ä¸»ç»„ä»¶ä¸­é›†æˆ

## ğŸ“ˆ æ€§èƒ½ç›¸å…³

### çŠ¶æ€ä¼˜åŒ–å»ºè®®

å½“å‰ä¸»ç»„ä»¶æœ‰60+ä¸ªuseStateï¼Œå»ºè®®åˆ†ç¦»ä¸º5ä¸ªCustom Hooksï¼š

1. **useEditingState** - ç¼–è¾‘çŠ¶æ€ç»„
2. **useTimeRangeEditing** - æ—¶é—´ç¼–è¾‘çŠ¶æ€ç»„
3. **useAudioState** - éŸ³é¢‘çŠ¶æ€ç»„
4. **useLoadingStates** - åŠ è½½çŠ¶æ€ç»„
5. **useUIStates** - UIçŠ¶æ€ç»„

è¯¦è§ï¼š`COMPONENT_DEPENDENCY_MAP.md` ç¬¬7éƒ¨åˆ†

### å…¶ä»–ä¼˜åŒ–ç‚¹

- localStorageç¼“å­˜ï¼š`videoCacheMap`ã€`uploadedImages`
- è½®è¯¢ä¼˜åŒ–ï¼šæœ€å¤š60æ¬¡ Ã— 5ç§’ = 5åˆ†é’Ÿè¶…æ—¶
- DnDæ€§èƒ½ï¼šä½¿ç”¨SortableContextåŒ…è£…ï¼Œæ”¯æŒé”®ç›˜æ“ä½œ

## ğŸš€ å…³é”®æŠ€æœ¯æ ˆ

- **UIæ¡†æ¶**: React 18+
- **UIç»„ä»¶**: Ant Design (Button, Select, Segmented, Modal)
- **æ‹–æ‹½**: @dnd-kit (core, sortable)
- **å›¾æ ‡**: @iconify/react
- **è·¯ç”±**: react-router-dom
- **æç¤º**: react-hot-toast
- **å›½é™…åŒ–**: I18nContext (è‡ªå®šä¹‰)

## ğŸ“ æ–‡ä»¶ç»Ÿè®¡

- **ä¸»æ–‡ä»¶**: ShortplayEntryPage.tsx (4,491è¡Œ)
- **å­ç»„ä»¶**: 14ä¸ª (2,588è¡Œæ€»è®¡)
- **Hooks**: 5ä¸ªå†…éƒ¨ + 3ä¸ªå…¨å±€
- **APIæ¥å£**: 20+ä¸ª
- **ç±»å‹å®šä¹‰**: 20+ä¸ªæ¥å£
- **æ€»ä»£ç é‡**: 7,000+è¡Œ

## ğŸ” è°ƒè¯•æŠ€å·§

### æŸ¥çœ‹å®Œæ•´çš„Propsæµå‘

åœ¨å­ç»„ä»¶console.log(props)ï¼ŒæŸ¥çœ‹ä»ä¸»ç»„ä»¶ä¼ é€’ä¸‹æ¥çš„æ‰€æœ‰props

### è¿½è¸ªçŠ¶æ€å˜åŒ–

åœ¨ä¸»ç»„ä»¶ä¸­æ·»åŠ console.logåœ¨å…³é”®setStateå‰åï¼š
```typescript
const handleGenerate = async () => {
  console.log('Before generate:', { seriesId, selectedScene });
  // ... API call
  setSeriesId(newId);
  console.log('After generate:', { seriesId: newId });
};
```

### æ£€æŸ¥DnDé…ç½®

sensorsé…ç½®åœ¨handleDragEndå‰ï¼ŒéªŒè¯ä¼ æ„Ÿå™¨æ˜¯å¦æ­£ç¡®æ·»åŠ 

### ç½‘ç»œè°ƒè¯•

æ‰“å¼€æµè§ˆå™¨DevTools â†’ Networkï¼ŒæŸ¥çœ‹APIè°ƒç”¨ï¼š
- `/episode-api/storyai/series/create` - ç”Ÿæˆè„šæœ¬
- `/episode-api/storyai/ai/video/generate` - ç”Ÿæˆè§†é¢‘
- `/episode-api/storyai/ai/video/progress` - è½®è¯¢è¿›åº¦

## ğŸ“š ç›¸å…³é“¾æ¥

- **DnD Kitæ–‡æ¡£**: https://docs.dndkit.com/
- **Ant Design**: https://ant.design/
- **React Hooks**: https://react.dev/reference/react

## ğŸ“ å­¦ä¹ è·¯å¾„å»ºè®®

### 1. **åˆçº§ç†è§£** (30åˆ†é’Ÿ)
   - é˜…è¯»æœ¬æ–‡ README_SHORTPLAY_ARCHITECTURE.md
   - æµè§ˆ SHORTPLAY_STRUCTURE_ANALYSIS.md çš„ç›®å½•å’Œæ¦‚è§ˆéƒ¨åˆ†

### 2. **æ·±å…¥å­¦ä¹ ** (2å°æ—¶)
   - è¯¦ç»†é˜…è¯» SHORTPLAY_STRUCTURE_ANALYSIS.md
   - æŸ¥çœ‹ COMPONENT_DEPENDENCY_MAP.md çš„ç»„ä»¶æ ‘ç»“æ„

### 3. **å®è·µåº”ç”¨** (åŠå¤©)
   - æ‰“å¼€IDEï¼Œå¯¹ç…§æ–‡æ¡£æŸ¥çœ‹å®é™…ä»£ç 
   - è·Ÿè¸ªä¸€ä¸ªå®Œæ•´æµç¨‹ï¼ˆå¦‚è„šæœ¬ç”Ÿæˆï¼‰
   - å°è¯•ä¿®æ”¹ä¸€ä¸ªå°åŠŸèƒ½

### 4. **æ·±åº¦å¼€å‘** (éœ€è¦æ—¶æŸ¥è¯¢)
   - æ ¹æ®ä¿®æ”¹åœºæ™¯æŸ¥æ‰¾å¯¹åº”ä½ç½®
   - å‚è€ƒç°æœ‰å®ç°æ–¹å¼ç¼–å†™æ–°åŠŸèƒ½
   - æŸ¥çœ‹APIå…³ç³»å›¾ç†è§£å‰åç«¯åä½œ

---

**æ–‡æ¡£æ›´æ–°æ—¶é—´**: 2025-11-03
**æ¶æ„ç‰ˆæœ¬**: 1.0
**ç»´æŠ¤è€…**: è§git commit history
